<html>
	
<head>
	<title>Javascript</title>
  <script type="text/javascript" src="js/jquery-1.6.1.min.js"></script>
  <script type="text/javascript" src="js/typeface-0.15.js"></script>
  <script type="text/javascript" src="js/optimer_bold_italic.typeface.js"></script>
  <script type="text/javascript" src="js/optimer_bold.typeface.js"></script>
  <script type="text/javascript" src="js/optimer_italic.typeface.js"></script>
  <script type="text/javascript" src="js/optimer_regular.typeface.js"></script>
  
	<style>
		body {
			font-family:Optimer;
			font-size:14px;
		}
		textarea {
			font-family:"Courier New";
			width:100%;
			overflow:visible;
		}
		#script table {
			border:1px solid #D0DAFD;
			width:100%;
			font-family:Optimer;
			font-size:14px;
		}
		#script table tr td{
			background-color:#D0DAFD;
		}
		#container {
			margin:auto;
			width:800px;
		}
	</style>
</head>

<body>
	<div id="container">
    <div id="info">
    	<div id="title">JavaScript Injector: Nicholas Workshop</div>
      <div id="description">You can inject javascript to the page</div>
    </div>
    <div id="control">
    	<div id="select">
        <a id="all" href="#">Select All</a> 
        <a id="none" href="#">Select None</a>
      </div>
      <div id="action">
        <button id="remove">Delete Selected Scripts</button>
        <button id="refresh">Refresh Script Table</button>
      </div>
    </div>
    <div id="script"></div>
    <div id="copyright">PS. jQuery is already injected. Developed by Nicholas Wong</div>
  </div>
</body>
	
<script>

	//__SETTING__//
	const background = chrome.extension.getBackgroundPage();
	
	//__DEBUG__//
	var debug = {
		mode: true,
		log: function(string) { 
			if (this.mode) background.console.log("O: " + string); 
		}
	}
	
	//__ONLOAD__//
	debug.log("Debug Mode");
	refresh();
	
	//__DISPLAY__//
	function refresh() {
		var code = "<table>";
		code += "<tr><th></th><th>SCRIPTS</th></tr>";
		//for (var i=0; i<background.storage.length(); i++) {
		for (id in background.storage.data) {
			code += "<tr>";
				code += "<td>";
					code += "<input type='checkbox' alt='"+id+"' />";
				code += "</td>";
				code += "<td>";
					code += "<div>URL: "+background.storage.get(id).url+"</div>";
					code += "<textarea>"+background.storage.get(id).script+"</textarea>";
				code += "</td>";
			code += "</tr>";
		}
		code += "</table>";
		$("#script").html(code);
	}

	//__LISTENER__//
	$("#select #all").click( function() { 
		$("input:checkbox").attr('checked', true); 
	});
	$("#select #none").click(function() { 
		$("input:checkbox").attr('checked', false); 
	});
	$("#action #remove").click(function() {
		if( confirm ("Are you sure to remove the selected script(s)?") ) {
			$("input:checked").each(function(){
				background.storage.remove( $(this).attr("alt") );
			});
			refresh();
		}
	});
	$("#action #refresh").click(function() {
		refresh();
	});
	
</script>
</html>