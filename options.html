<html>
	
<head>
	<title>Javascript</title>
	<link type="text/css" rel="stylesheet" href="css/options.css"/> 
  <link type="text/css" rel="stylesheet" href="css/grid/960.css"/> 
</head>

<body>
	<div id="container" class="container_12">
    <div id="info">
    	<button id="reset">Reset Database to Fix Errors</button>
    	<div id="title">JavaScript Injector: Nicholas Workshop</div>
      <div id="description">You can inject javascript to the page</div>
      <!--<div id="divider"></div>-->
    </div>
    <div id="board">
      <div id="script"></div>
      <div id="control">
        <div id="select">
          <a id="all" href="#">Select All</a> 
          <a id="none" href="#">Select None</a>
        </div>
        <div id="action">
          <button id="remove">Delete Selected Scripts</button>
          <button id="refresh">Reload Script Table</button>
        </div>
      </div>
      <div id="copyright">Â© Nicholas Workshop</div>


<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<table>
<tr><td><input type="hidden" name="on0" value="Select">Select</td></tr>
<tr><td>
<select name="os0">
	<option value="Option 1">Option 1 </option>
	<option value="Option 2">Option 2 </option>
	<option value="Option 3">Option 3 </option>
</select>
</td></tr>
</table>
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypalobjects.com/en_GB/HK/i/btn/btn_buynowCC_LG_wCUP.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online.">
<img alt="" border="0" src="https://www.paypalobjects.com/en_GB/i/scr/pixel.gif" width="1" height="1">
</form>

<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_xclick-subscriptions">
<input type="hidden" name="business" value="nicholasworkshop@gmail.com">
<input type="hidden" name="lc" value="US">
<input type="hidden" name="item_name" value="Donate Nicholas Workshop, Thank You!">
<input type="hidden" name="no_note" value="1">
<input type="hidden" name="src" value="1">
<input type="hidden" name="a3" value="9.99">
<input type="hidden" name="p3" value="1">
<input type="hidden" name="t3" value="M">
<input type="hidden" name="currency_code" value="USD">
<input type="hidden" name="bn" value="PP-SubscriptionsBF:btn_subscribeCC_LG.gif:NonHostedGuest">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_subscribeCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>


  	</div>
  </div>
</body>

<script type="text/javascript" src="js/jquery/jquery-1.6.1.min.js"></script>
<script>

//__SETTING__//
const background = chrome.extension.getBackgroundPage();

//__DEBUG__//
var debug = {
	mode: true,
	log: function(string) { 
		if (this.mode) background.console.log("O: " + string); 
	}
}

//__LOADER__//
var load = {
	refresh: function() {
		location.reload(true);
	},
	table: function() {
		var code = "";
		if (background.storage.data.length>0) {
			code +="<table>";
			code += "<tr><th style='width:17px;'></th><th>SCRIPTS</th></tr>";
			for (id in background.storage.current) {debug.log(1);
				code += "<tr class='row"+id+"'>";
					code += "<td>";
						code += "<input type='checkbox' class='select' alt='"+id+"' />";
					code += "</td>";
					code += "<td>";
						code += "<div class='detail'>";
							code += "<span class='title'>Url</span><input type='text' class='url' value='"+background.storage.get(id).url+"'/>";
							$(background.storage.get(id).include).each(function() {
								code += '<div class="include"><span class="title">Include</span><input type="text" class="include" value="'+this+'"/><img class="include minus" src="img/minus.png"/></div>';
							});
							code += "<textarea class='script'>"+background.storage.get(id).script+"</textarea>";
						code += '</div>';
						code += '<div class="option">';
							code += '<input type="checkbox" class="save" '+background.storage.get(id).save+'/>Save';
							code += '<input type="checkbox" class="autorun" '+background.storage.get(id).autorun+'/>Autorun';
							code += '<input type="checkbox" class="jquery" '+background.storage.get(id).jquery+'/>jQuery';
						code += '</div>';
						code += '<div class="edit">';
							code += '<button class="update" alt='+id+'>Update</button>';
						code += '</div>';
					code += "</td>";
				code += "</tr>";
			}
			code += "</table>";
		}
		else {
			code += "<table><tr><th>NO SCRIPTS SAVED</th></tr></table>";
		}
		$("#script").html(code);
		$("img.include.minus").click(function() {
			$(this).parent().remove();
		});
		$(".edit .update").click(function() {
			var id = $(this).attr("alt");
			var include = [];
			$(".row"+id+" .detail input.include").each(function() {
				include.push($(this).val());
			});
			var detail = {
				id      : $(this).attr("alt"),
				url     : $(".row"+id+" .detail .url").val(),
				script  : $(".row"+id+" .detail .script").val(),
				save    : $(".row"+id+" .option .save").attr('checked'),
				autorun : $(".row"+id+" .option .autorun").attr('checked'),
				jquery  : $(".row"+id+" .option .jquery").attr('checked'),
				include : include
			};
			background.storage.save(detail);
			load.refresh();
		});
	}
}

//__LISTENER__//
$("#select #all").click( function() { 
	$("input.select:checkbox").attr('checked', true); 
});
$("#select #none").click(function() { 
	$("input.select:checkbox").attr('checked', false); 
});
$("#action #remove").click(function() {
	if( confirm ("Are you sure to remove the selected script(s)?") ) {
		$("input.select:checked").each(function(){
			background.storage.remove( $(this).attr("alt") );
		});
		load.refresh();
	}
});
$("#info #reset").click(function() {
	if( confirm ("This option is to fix any errors happened.\nAre you sure to reset the database?") ) {
		background.storage.data.clear();
		load.refresh();
	}
});
$("#action #refresh").click(function() {
	load.refresh();
});

//__ONLOAD__//
debug.log("Debug Mode");
load.table();
	
</script>
</html>