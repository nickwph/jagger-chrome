<html>
	
<head>
	<title>Javascript</title>
	<link type="text/css" rel="stylesheet" href="css/options.css"/> 
  <link type="text/css" rel="stylesheet" href="css/grid/960.css"/> 
</head>

<body>
	<div id="container" class="container_12">
  	
    <div id="info">
    	<button id="reset">Reset Database to Fix Errors</button>
    	<div id="title">JavaScript Injector: Nicholas Workshop</div>
      <div id="description">You can inject javascript to the page</div>
      <!--<div id="divider"></div>-->
    </div>
    
  	<div class="donate shadow">
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
        ">
        <input type="image" src="img/donate_btn.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online.">
        <img alt="" border="0" src="https://www.paypalobjects.com/en_GB/i/scr/pixel.gif" width="1" height="1">
      </form>
    </div>
    
      <div id="script"></div>
      <div id="control">
        <div id="select">
          <a id="all" href="#">Select All</a> 
          <a id="none" href="#">Select None</a>
        </div>
        <div id="action">
          <button id="remove">Delete Selected Scripts</button>
          <button id="refresh">Reload Script Table</button>
        </div>
      </div>
      
			<div class="donate shadow">
        <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
          <input type="hidden" name="cmd" value="_s-xclick">
          <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
          ">
          <input type="image" src="img/donate_btn.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online.">
          <img alt="" border="0" src="https://www.paypalobjects.com/en_GB/i/scr/pixel.gif" width="1" height="1">
        </form>
      </div>
			<div id="debug"></div>
      <div id="copyright">Â© Nicholas Workshop</div>
      <div id="website"><a href="http://nicholasworkshop.co.cc">nicholasworkshop.co.cc</a></div>
      
  </div>
</body>

<script type="text/javascript" src="js/jquery/jquery-1.6.1.min.js"></script>
<script>

//__SETTING__//
const background = chrome.extension.getBackgroundPage();

//__DEBUG__//
var debug = {
	mode: true,
	log: function(string) { 
		if (this.mode) background.console.log("O: " + string); 
	}
}

//__LOADER__//
var load = {
	refresh: function() {
		location.reload(true);
	},
	table: function() {
		var code = "";
		if (background.storage.length()>0) {
			code +="<table>";
			code += "<tr><th style='width:17px;'></th><th>SCRIPTS</th></tr>";
			for (id in background.storage.current) {debug.log(1);
				code += "<tr class='row"+id+"'>";
					code += "<td>";
						code += "<input type='checkbox' class='select' alt='"+id+"' />";
					code += "</td>";
					code += "<td>";
						code += "<div class='detail'>";
							code += "<span class='title'>Url</span><input type='text' class='url' value='"+background.storage.get(id).url+"'/>";
							$(background.storage.get(id).include).each(function() {
								code += '<div class="include"><span class="title">Include</span><input type="text" class="include" value="'+this+'"/><img class="include minus" src="img/minus.png"/></div>';
							});
							code += "<textarea class='script'>"+background.storage.get(id).script+"</textarea>";
						code += '</div>';
						code += '<div class="option">';
							code += '<input type="checkbox" class="save" '+background.storage.get(id).save+'/>Save';
							code += '<input type="checkbox" class="autorun" '+background.storage.get(id).autorun+'/>Autorun';
							code += '<input type="checkbox" class="jquery" '+background.storage.get(id).jquery+'/>jQuery';
						code += '</div>';
						code += '<div class="edit">';
							code += '<button class="update" alt='+id+'>Update</button>';
						code += '</div>';
					code += "</td>";
				code += "</tr>";
			}
			code += "</table>";
		}
		else {
			code += "<table><tr><th>NO SCRIPTS SAVED</th></tr></table>";
		}
		$("#script").html(code);
		$("img.include.minus").click(function() {
			$(this).parent().remove();
		});
		$(".edit .update").click(function() {
			var id = $(this).attr("alt");
			var include = [];
			$(".row"+id+" .detail input.include").each(function() {
				include.push($(this).val());
			});
			var detail = {
				id      : $(this).attr("alt"),
				url     : $(".row"+id+" .detail .url").val(),
				script  : $(".row"+id+" .detail .script").val(),
				save    : $(".row"+id+" .option .save").attr('checked'),
				autorun : $(".row"+id+" .option .autorun").attr('checked'),
				jquery  : $(".row"+id+" .option .jquery").attr('checked'),
				include : include
			};
			background.storage.save(detail);
			load.refresh();
		});
	}
}

//__LISTENER__//
$("#select #all").click( function() { 
	$("input.select:checkbox").attr('checked', true); 
});
$("#select #none").click(function() { 
	$("input.select:checkbox").attr('checked', false); 
});
$("#action #remove").click(function() {
	if( confirm ("Are you sure to remove the selected script(s)?") ) {
		$("input.select:checked").each(function(){
			background.storage.remove( $(this).attr("alt") );
		});
		load.refresh();
	}
});
$("#info #reset").click(function() {
	if( confirm ("This option is to fix any errors happened.\nAre you sure to reset the database?") ) {
		background.storage.reset();
		load.refresh();
	}
});
$("#action #refresh").click(function() {
	load.refresh();
});

//__ONLOAD__//
debug.log("Debug Mode");
load.table();
$("debug").html(background.storage.current());

</script>
</html>