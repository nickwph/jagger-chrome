<script type="text/javascript" src="jquery/jquery-1.6.1.min.js"></script>
	
<body>

	<url>
		<label>URL</label>
		<input type="text" value="url" />
	</url>
	
	<code>
		<label>Script</label>
		<textarea>alert('Succeed!');</textarea>
	</code>
	
	<autorun>
		<label>Autorun</label>
		<input type="checkbox" />
	</autorun>
	
	<jquery>
		<label>jQuery</label>
		<input type="checkbox" checked />
	</jquery>
	
	<inject>
		<button>Inject</button>
	</inject>
	
</body>
	
<script type="text/javascript">

	var background = chrome.extension.getBackgroundPage();
	var saved = false;
    var savedId;
    
	chrome.windows.getCurrent(function(window) {
		chrome.tabs.getSelected(window.id, function(tab){
            $("url input").val(tab.url);
			background.database.getMatchedScript(tab.url, function(data) {
				console.log(data);
                saved = true;
                savedId = data.id;
				$("url     input").val(data.url);
				$("code textarea").val(data.script);
				$("autorun input").attr('checked', data.autorun=="true"?true:false);
				$("jquery  input").attr('checked', data.jquery=="true"?true:false);
				if (data.autorun == "true") {
					if (data.jquery == "true") injector.injectJQuery(tabId);
					injector.injectScript(tabId, data.script);
				}
			}); 
		});
	});
	
	$("inject button").click(function() {
        chrome.windows.getCurrent(function(window) {
            chrome.tabs.getSelected(window.id, function(tab){
                if ($("jquery input").checked == "true") background.injector.injectJQuery(tab.id);
                background.injector.injectScript(tab.id, $("code textarea").val());
            });
        });
        if (saved) {
            background.database.updateScript(savedId,
                                             $("url input").val(), 
                                             $("code textarea").val(), 
                                             $("autorun input").attr('checked')?true:false, 
                                             $("jquery input").attr('checked')?true:false
            );
        }
        else {
            background.database.addScript($("url input").val(), 
                                          $("code textarea").val(), 
                                          $("autorun input").attr('checked')?true:false, 
                                          $("jquery input").attr('checked')?true:false
            );
            database.getLastInsertId(function(id) { savedId = id });
            saved = true;
        }
        
    });
</script>

